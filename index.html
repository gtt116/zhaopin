<!doctype html>
<head>
  <title>职位数量走势图</title>
  <script src="http://cdn.bootcss.com/jquery/2.1.4/jquery.min.js"></script>
  <script src="http://cdn.bootcss.com/highcharts/4.1.7/highcharts.js"></script>
  <style>
  h1,h2,p {
    text-align: center;
  }

  .half {
    width: 45%;
    display: inline-block;
  }
  </style>
</head>
<body>

 <h1>智联职位数量走势图</h1>
 <div id="zhilian"></div>
 <p>
  数据来源于智联招聘（zhaopin.com）每天抓取特定关键词的职位数量，通过职位数量
  反应技术的市场接纳率，特别是新型的技术，如 docker， openstack 等。
 </p>

  <h1>lagou: 职位薪资走势图</h1>
  <h2>数量走势</h2>
  <div id="lagou_count"></div>

  <div class="half">
    <h2>中位数</h2>
    <div id="lagou"></div>
 </div>

  <div class="half">
    <h2>众数</h2>
    <div id="lagou_mode"></div>
  </div>

  <p>
    数据来源于拉钩网（lagou.com）每天抓取特定关键词的职位，通过计算职位的薪资
    中位数，判断市场行情和走势。
  </p>

 <script>
$(function() {
    function render_highcharts( json_url, div_id, y_text ){

      $.getJSON( json_url )
        .done(function( json ) {
          /*
          json looks like:

            {
              "python": [["1990-08-08",2], ['1992-03-03', 3]]
              "java": [["1990-08-08",2], ['1992-03-03', 3] ]
            }
          */
          console.debug("Parsing json to date")
          json_data = {};
          series = [];
          for (name in json){
            data = [];
            items = json[name];
            for (var j = 0 ; j < items.length ; j++){
              data.push( [Date.parse(items[j][0]), items[j][1]] );
            }
            series.push({'name': name, 'data': data})
          }

          $(div_id).highcharts({
            chart: {
              type: 'spline'
            },
            title: {
              text: ""
            },
            tooltip: {
              shared: true,
              crosshairs: true,
              xDateFormat: '%Y-%m-%d',
            },
            yAxis: {
              title: {
                text: y_text
              }
            },
            xAxis: {
              title: {
                text: "Datetime"
              },
              type: 'datetime',
              dateTimeLabelFormats: {
                day: '%m-%d',
                month: "%m",
              },
          },
            series: series
          });
        })
        .fail(function( jqxhr, textStatus, error ) {
          var err = textStatus + ", " + error;
          $(div_id).html( "Request Failed: " + err );
        });

    }

    render_highcharts("zhilian_count.json", "#zhilian", "数量");
    render_highcharts("lagou_count.json", "#lagou_count", "数量");
    render_highcharts("lagou_salary.json", "#lagou", "薪资(K)");
    render_highcharts("lagou_salary_mode.json", "#lagou_mode", "薪资(K)");

  });
 </script>
</body>
</html>
